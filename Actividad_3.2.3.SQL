--se ejecuta despues de crear el primer usuario para tener privilegios de levantar una base de datos
--CASO 1
GRANT CREATE SESSION TO MDY2131_P12_1;
GRANT "RESOURCE" TO MDY2131_P12_1;
ALTER USER MDY2131_P12_1 DEFAULT ROLE "RESOURCE";
GRANT CREATE VIEW TO MDY2131_P12_1;

DROP ROLE ROL_DBA;

CREATE ROLE ROL_DBA;
GRANT CREATE ANY TABLE, UPDATE ANY TABLE, DROP ANY TABLE, CREATE ANY SEQUENCE, CREATE ANY INDEX, ALTER DATABASE TO ROL_DBA;

GRANT ROL_DBA TO MDY2131_P12_1;
ALTER USER MDY2131_P12_1 DEFAULT ROLE ROL_DBA;

DROP ROLE ROL_DDL;

CREATE ROLE ROL_DDL;
GRANT CREATE ANY VIEW, CREATE ANY TRIGGER, CREATE ANY PROCEDURE, CREATE ANY MATERIALIZED VIEW TO ROL_DDL;
GRANT SELECT ON dba_tables TO ROL_DDL;
GRANT INSERT, UPDATE, DELETE ON MDY2131_P12_1.CREDITO_CLIENTE TO ROL_DDL;
GRANT INSERT, UPDATE, DELETE ON MDY2131_P12_1.PRODUCTO_INVERSION_CLIENTE TO ROL_DDL;
GRANT INSERT, UPDATE, DELETE ON MDY2131_P12_1.CUOTA_CREDITO_CLIENTE TO ROL_DDL;

GRANT CREATE SESSION TO MDY2131_P12_2;
GRANT ROL_DDL TO MDY2131_P12_2;
ALTER USER MDY2131_P12_2 DEFAULT ROLE ROL_DDL;

DROP ROLE RON_DML;

CREATE ROLE ROL_DML;
GRANT SELECT ON MDY2131_P12_1.COMUNA TO ROL_DML;
GRANT SELECT ON MDY2131_P12_1.REGION TO ROL_DML;
GRANT SELECT ON MDY2131_P12_1.PROVINCIA TO ROL_DML;
GRANT SELECT ON MDY2131_P12_1.TIPO_CONTRATO TO ROL_DML;
GRANT SELECT ON MDY2131_P12_1.TIPO_MOVIMIENTO TO ROL_DML;

GRANT CREATE SESSION TO MDY2131_P12_3, MDY2131_P12_4;
GRANT ROL_DML TO MDY2131_P12_3, MDY2131_P12_4;
ALTER USER MDY2131_P12_3 DEFAULT ROLE ROL_DML;
ALTER USER MDY2131_P12_4 DEFAULT ROLE ROL_DML;
--CASO 2

SELECT TO_CHAR(C.NUMRUN, '09G999G999')||'-'||C.DVRUN AS "RUT CLIENTE",
C.PNOMBRE||' '||C.SNOMBRE||' '||C.APPATERNO||' '||C.APMATERNO AS "NOMRE CLIENTE",
TO_CHAR(C.FECHA_NACIMIENTO, 'dd "de" month') AS "FECHA NACIMIENTO",
C.DIRECCION||', '||CO.NOMBRE_COMUNA AS "DIRECCION"
FROM MDY2131_P12_1.CLIENTE C
JOIN MDY2131_P12_1.COMUNA CO ON CO.COD_COMUNA = C.COD_COMUNA
                            AND CO.COD_PROVINCIA = C.COD_PROVINCIA
                            AND CO.COD_REGION = C.COD_REGION
WHERE EXTRACT(MONTH FROM FECHA_NACIMIENTO) = 9
--WHERE EXTRACT(MONTH FROM FECHA_NACIMIENTO) = EXTRACT(MONTH FROM SYSDATE)+1
ORDER BY "FECHA NACIMIENTO" ASC, C.APPATERNO
;
